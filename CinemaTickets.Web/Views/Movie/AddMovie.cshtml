
@{
    ViewBag.Title = "Add movie";
}
<h2>Add movie to database</h2>
<hr />
<form>
    <div class="row">
        <div class="col-md-4">
            <div class="form-group">
                <label for="title">Title</label>
                <input type="text" class="form-control" id="title" aria-describedby="titleHelp" placeholder="Title">
            </div>
            <div class="form-group">
                <label for="rating">Rating</label>
                <input type="text" class="form-control" id="rating" placeholder="Rating">
            </div>

            <div class="form-group">
                <label for="language">Language</label>
                <input type="text" class="form-control" id="language" placeholder="Language">
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-group">
                <label for="minutes">Minutes</label>
                <input type="number" class="form-control" id="minutes" placeholder="Minutes">
            </div>

            <div class="form-group">
                <label for="producer">Producer</label>
                <input type="text" class="form-control" id="producer" placeholder="Producer">
            </div>

            <div class="form-group">
                <label for="genre">Genre</label>
                <input type="text" class="form-control" id="genre" placeholder="Genre">
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-group">
                <label for="description">Description</label>
                <textarea class="form-control" id="description" rows="9"></textarea>
            </div>
        </div>
    </div>

   
            <div class="form-group">
                <label for="files">Picture input</label>
                <input type="file" class="form-control-file" id="files" aria-describedby="fileHelp">
                <small id="fileHelp" class="form-text text-muted">Select a picture from here</small>
            </div>

            <button id="addMovieButton" class="btn btn-primary" style="float:right;margin-top:-50px;">Add movie</button>
</form>
@section Scripts {
    <script>

        $("#addMovieButton").click(function (e) {
            e.preventDefault();
            var file = document.getElementById('files').files[0];
            if (file == undefined) {
                alert("You must select a picture for the movie!");
                return;
            }

            var filenameExtension = file.name.split('.').pop();
            var allowedPictureFormats = ['jpeg', 'gif', 'bmp', 'png', 'jpg'];

            if (!allowedPictureFormats.includes(filenameExtension)) {
                alert("Invalid file format: " + filenameExtension)
                return;
            }
            var fd = new FormData();

            fd.append("files", file);
            fd.append("title", $('#title').val());
            fd.append("rating", $('#rating').val());
            fd.append("language", $('#language').val());
            fd.append("minutes", $('#minutes').val());
            fd.append("producer", $('#producer').val());
            fd.append("description", $('#description').val());
            fd.append("genre", $('#genre').val());

            $.ajax({
                url: "@Url.Action("AddMovie","Movie")",
                type: 'POST',
                processData: false,
                contentType: false,
                data: fd,
                success: successCallback,
                error: errorCallback
            })
        })

        function errorCallback() {
            alert("error");
        }
        function successCallback() {
            alert("success");
            $("input:text").val('');
            $("#description").val('');
            $('#files').val('');
        }
    </script>
}